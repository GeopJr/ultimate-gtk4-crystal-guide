import{_ as s,c as n,o as a,a as l}from"./app.4beb082a.js";var o="/assets/en/code-0.png";const d=JSON.parse('{"title":"Code","description":"","frontmatter":{},"headers":[{"level":2,"title":"Dependencies","slug":"dependencies"},{"level":2,"title":"src/modules/prerequisites.cr","slug":"src-modules-prerequisites-cr"},{"level":2,"title":"src/tiny-stats.cr (main file)","slug":"src-tiny-stats-cr-main-file"},{"level":2,"title":"src/modules/functions/meters.cr","slug":"src-modules-functions-meters-cr"},{"level":2,"title":"src/modules/functions/about_action.cr","slug":"src-modules-functions-about-action-cr"},{"level":2,"title":"src/modules/views/main.cr","slug":"src-modules-views-main-cr"}],"relativePath":"en/first-app/code.md","lastUpdated":1657016119000}'),p={name:"en/first-app/code.md"},e=l(`<h1 id="code" tabindex="-1">Code <a class="header-anchor" href="#code" aria-hidden="true">#</a></h1><h2 id="dependencies" tabindex="-1">Dependencies <a class="header-anchor" href="#dependencies" aria-hidden="true">#</a></h2><p>We need the following:</p><ul><li><code>gtk4.cr</code></li><li><code>hardware</code></li><li><code>non-blocking-spawn</code></li><li><code>gettext.cr</code></li></ul><div class="language-yaml"><span class="copy"></span><pre><code><span class="line"><span style="color:#F07178;">dependencies</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">gtk4</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">github</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">hugopl/gtk4.cr</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">hardware</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">github</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">crystal-community/hardware</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">non-blocking-spawn</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">github</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">GeopJr/non-blocking-spawn</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">gettext</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">github</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">GeopJr/gettext.cr</span></span>
<span class="line"></span></code></pre></div><h2 id="src-modules-prerequisites-cr" tabindex="-1"><code>src/modules/prerequisites.cr</code> <a class="header-anchor" href="#src-modules-prerequisites-cr" aria-hidden="true">#</a></h2><p>For now, we need to gather the app version from <code>shard.yml</code> and load the UI &amp; CSS files as strings using macros.</p><p>These will later be replaced with GResource.</p><div class="language-crystal"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;font-style:italic;">module</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Tiny</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Stats</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">extend</span><span style="color:#A6ACCD;"> self</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">VERSION</span><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{{</span><span style="color:#82AAFF;">read_file</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./shard.yml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">split</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">version: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">].</span><span style="color:#82AAFF;">split</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]}}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">UI</span><span style="color:#A6ACCD;">         </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{{</span><span style="color:#82AAFF;">read_file</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./data/ui/app.ui</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)}}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">CSS_STRING</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{{</span><span style="color:#82AAFF;">read_file</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./data/css/style.css</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)}}</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span></code></pre></div><h2 id="src-tiny-stats-cr-main-file" tabindex="-1"><code>src/tiny-stats.cr</code> (main file) <a class="header-anchor" href="#src-tiny-stats-cr-main-file" aria-hidden="true">#</a></h2><p>This is responsible for the load order and for loading dependencies. However it can still be used for code that will run after the other files.</p><p>We create a new <code>Builder</code> using the <code>UI</code> global variable from <code>prerequisites</code>, a new <code>CssProvider</code> and a new <code>Application</code>.</p><p>Since we assigned IDs to the widgets we are going to need, we can assign them to global vars for easy access later on by down-casting.</p><div class="language-crystal"><span class="copy"></span><pre><code><span class="line"><span style="color:#F78C6C;">require</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">gtk4</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">require</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hardware</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">require</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">non-blocking-spawn</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">require</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./modules/prerequisites.cr</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># You can also just place the contents of it here,</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">                                     # just make sure it&#39;s above the code below</span></span>
<span class="line"><span style="color:#F78C6C;">require</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./modules/functions/*</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">require</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./modules/views/*</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">module</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Tiny</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Stats</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">B_UI</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Builder</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">new_from_string</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">UI</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">UI</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bytesize</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">to_i64</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">CSS</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">CssProvider</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">new</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">NOTEBOOK</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Notebook</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cast</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">B_UI</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tinyNotebook</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">MENU_BTN</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">MenuButton</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cast</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">B_UI</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tinyMenu</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">CPU_GRID</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Grid</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cast</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">B_UI</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tinyCPU</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">MEMORY_AVAILABLE</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Label</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cast</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">B_UI</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tinyAvailable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">MEMORY_USED</span><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Label</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cast</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">B_UI</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tinyUsed</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">MEMORY_TOTAL</span><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Label</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cast</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">B_UI</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tinyTotal</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">NET_UP</span><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Label</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cast</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">B_UI</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tinyUp</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">NET_DOWN</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Label</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cast</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">B_UI</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tinyDown</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">CPU_USAGE</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Label</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cast</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">B_UI</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tinyCPUUsage</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">CPU_USED</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Label</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cast</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">B_UI</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tinyCPUUsed</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">CPU_TOTAL</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Label</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cast</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">B_UI</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tinyCPUTotal</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">APP</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Application</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">new</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dev.geopjr.tinystats</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gio</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">ApplicationFlags</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">None</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span></code></pre></div><h2 id="src-modules-functions-meters-cr" tabindex="-1"><code>src/modules/functions/meters.cr</code> <a class="header-anchor" href="#src-modules-functions-meters-cr" aria-hidden="true">#</a></h2><p>We want to update the hardware stats in an infinite loop. To achieve this we are going to spawn a fiber (with the parallelism flag) that updates the labels (using the global vars from before) every second.</p><p>We also want it to start on demand, so we are going to wrap it in a method inside a new module.</p><div class="language-crystal"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;font-style:italic;">module</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Tiny</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Stats</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">module</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Meters</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">extend</span><span style="color:#A6ACCD;"> self</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">init</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">Non</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Blocking</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">spawn </span><span style="color:#89DDFF;font-style:italic;">do</span></span>
<span class="line"><span style="color:#A6ACCD;">        old_in</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> old_out </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">        cpus </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Hardware</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">CPU</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">new</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">loop</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">do</span></span>
<span class="line"><span style="color:#A6ACCD;">          memory </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Hardware</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Memory</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">new</span></span>
<span class="line"><span style="color:#A6ACCD;">          net </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Hardware</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Net</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">new</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#FFCB6B;">MEMORY_USED</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">text </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">#{(</span><span style="color:#A6ACCD;">memory</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">used</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">1024</span><span style="color:#89DDFF;">).</span><span style="color:#A6ACCD;">to_i64</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> mb</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#FFCB6B;">MEMORY_AVAILABLE</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">text </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">#{(</span><span style="color:#A6ACCD;">memory</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">available</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">1024</span><span style="color:#89DDFF;">).</span><span style="color:#A6ACCD;">to_i64</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> mb</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#FFCB6B;">MEMORY_TOTAL</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">text </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">#{(</span><span style="color:#A6ACCD;">memory</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">total</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">1024</span><span style="color:#89DDFF;">).</span><span style="color:#A6ACCD;">to_i64</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> mb</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">          now_in</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> now_out </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> net</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">in_octets</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> net</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out_octets</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#FFCB6B;">NET_DOWN</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">text </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">#{(</span><span style="color:#A6ACCD;">now_in </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> old_in</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> kB/s</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#FFCB6B;">NET_UP</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">text </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">#{(</span><span style="color:#A6ACCD;">now_out </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> old_out</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> kB/s</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          old_in</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> old_out </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> now_in</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> now_out</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#FFCB6B;">CPU_USAGE</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">text </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">#{</span><span style="color:#A6ACCD;">cpus</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">usage!</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">to_i64</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> %</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#FFCB6B;">CPU_USED</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">text </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">#{</span><span style="color:#A6ACCD;">cpus</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">used</span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#FFCB6B;">CPU_TOTAL</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">text </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">#{</span><span style="color:#A6ACCD;">cpus</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">total</span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#82AAFF;">sleep</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">second</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span></code></pre></div><h2 id="src-modules-functions-about-action-cr" tabindex="-1"><code>src/modules/functions/about_action.cr</code> <a class="header-anchor" href="#src-modules-functions-about-action-cr" aria-hidden="true">#</a></h2><p>Similarly, let&#39;s also create the &quot;About app&quot; action.</p><p>We need to create a new <code>Gio#SimpleAction</code> with the name of the action we set in the UI file:</p><p><code>&lt;attribute name=&quot;action&quot;&gt;app.about&lt;/attribute&gt;</code> =&gt; <code>about</code></p><p>Then we add it to the <code>Gtk::Application</code> and handle its <code>activate_signal</code>.</p><div class="language-crystal"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;font-style:italic;">module</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Tiny</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Stats</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">extend</span><span style="color:#A6ACCD;"> self</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">about_action</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">app </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Application</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    action </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gio</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">SimpleAction</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">new</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">about</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">nil)</span></span>
<span class="line"><span style="color:#A6ACCD;">    app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add_action</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">action</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    action</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activate_signal</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">connect </span><span style="color:#89DDFF;font-style:italic;">do</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">show_about_dialog</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">APP</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">active_window</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">name:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">About Tiny Stats</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">application:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">APP</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">program_name:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Tiny Stats</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">version:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">VERSION</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">logo_icon_name:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dev.geopjr.tinystats</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">copyright:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\xA9 2021 Evangelos Paterakis</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">website:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://github.com/GeopJr/tiny-stats-template</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">authors:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Evangelos </span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#C3E88D;">GeopJr</span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#C3E88D;"> Paterakis</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">artists:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Evangelos </span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#C3E88D;">GeopJr</span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#C3E88D;"> Paterakis</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span></code></pre></div><h2 id="src-modules-views-main-cr" tabindex="-1"><code>src/modules/views/main.cr</code> <a class="header-anchor" href="#src-modules-views-main-cr" aria-hidden="true">#</a></h2><p>Since our app is very simple and has only one view, we&#39;ll glue everything together here.</p><p>We&#39;ll connect to the <code>startup</code> and <code>activate</code> signals. The <code>startup</code> signal will be used to load the CSS:</p><div class="language-crystal"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;font-style:italic;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">startup</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">app </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Application</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">CSS</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">load_from_data</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">CSS_STRING</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bytes</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span></code></pre></div><p>The <code>activate</code> signal emits every time your app launches, this means that it can emit <em>multiple</em> times. We wan&#39;t to avoid that with tiny stats and instead just focus the window if it&#39;s already running.</p><p>We also want the window title to change based on the <code>Notebook</code> page title. We can do so by connecting to the <code>switch_page_signal</code> and get the current page title using <code>Gtk::Notebook#tab_label_text</code>:</p><div class="language-crystal"><span class="copy"></span><pre><code><span class="line"><span style="color:#FFCB6B;">NOTEBOOK</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">switch_page_signal</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">connect </span><span style="color:#89DDFF;font-style:italic;">do </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">  window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">title </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Tiny Stats - </span><span style="color:#89DDFF;">#{</span><span style="color:#FFCB6B;">NOTEBOOK</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">tab_label_text</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">)}</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span></code></pre></div><p>We will also initialize the above mentioned functions:</p><div class="language-crystal"><span class="copy"></span><pre><code><span class="line"><span style="color:#FFCB6B;">Tiny</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Stats</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Meters</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">init</span></span>
<span class="line"><span style="color:#FFCB6B;">Tiny</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Stats</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">about_action</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>Let&#39;s also make Crystal exit when the app closes:</p><div class="language-crystal"><span class="copy"></span><pre><code><span class="line"><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">APP</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">run</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">ARGV</span><span style="color:#89DDFF;">))</span></span>
<span class="line"></span></code></pre></div><p>The finished file should be:</p><div class="language-crystal"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;font-style:italic;">module</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Tiny</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Stats</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">@@</span><span style="color:#A6ACCD;">main_window_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0_u32</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">startup</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">app </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Application</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">CSS</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">load_from_data</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">CSS_STRING</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bytes</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">activate</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">app </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Application</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    main_window </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">APP</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">window_by_id</span><span style="color:#89DDFF;">(@@</span><span style="color:#A6ACCD;">main_window_id</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> main_window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">present </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> main_window</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    window </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">ApplicationWindow</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cast</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">B_UI</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tinyWindow</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">    window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">application </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> app</span></span>
<span class="line"><span style="color:#A6ACCD;">    window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">title </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Tiny Stats - CPU</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@@</span><span style="color:#A6ACCD;">main_window_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">Tiny</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Stats</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Meters</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">init</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">Tiny</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Stats</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">about_action</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">NOTEBOOK</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">switch_page_signal</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">connect </span><span style="color:#89DDFF;font-style:italic;">do </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">      window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">title </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Tiny Stats - </span><span style="color:#89DDFF;">#{</span><span style="color:#FFCB6B;">NOTEBOOK</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">tab_label_text</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">)}</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">StyleContext</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add_provider_for_display</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">display</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">CSS</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">STYLE_PROVIDER_PRIORITY_APPLICATION</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">to_u32</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">present</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">APP</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">startup_signal</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">connect</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">-&gt;startup</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Application</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">APP</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activate_signal</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">connect</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">-&gt;activate</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Gtk</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Application</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">APP</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">run</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">ARGV</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span></code></pre></div><p>It should now be runnable:</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ crystal run src/tiny-stats.cr -Dpreview_mt</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p><img src="`+o+'" alt="Screenshot of the app running showing cpu info"></p>',40),t=[e];function c(r,F,D,y,C,A){return a(),n("div",null,t)}var B=s(p,[["render",c]]);export{d as __pageData,B as default};
